# BettaFish 部署到个人网站 - 任务清单

## 📋 部署概览

将 BettaFish 多智能体舆情分析系统集成到 PeaceWang 个人网站，通过 Tengine 反向代理提供访问。

---

## ✅ 阶段一：环境准备与规划

### 1.1 服务器环境确认
- [ ] 确认服务器 Python 版本（需要 3.9+）
- [ ] 确认服务器是否已安装 PostgreSQL 或 MySQL
- [ ] 确认服务器可用端口（5000, 8501, 8502, 8503）
- [ ] 确认服务器磁盘空间（建议至少 10GB）
- [ ] 确认服务器内存（建议至少 4GB）

### 1.2 部署方案选择
- [ ] 选择部署方式：源码部署 或 Docker 部署
- [ ] 确定数据库类型：PostgreSQL 或 MySQL（与现有 MySQL 复用或新建）
- [ ] 确定应用运行端口（建议使用内部端口，通过 Tengine 反向代理）

### 1.3 目录规划
- [ ] 确定 BettaFish 项目部署路径（建议：`/var/www/bettafish`）
- [ ] 确定日志目录路径
- [ ] 确定报告存储目录路径
- [ ] 确定数据库数据目录（如使用 Docker）

---

## ✅ 阶段二：代码与配置准备

### 2.1 项目文件准备
- [ ] 创建部署脚本目录结构
- [ ] 准备 `.env` 配置文件模板
- [ ] 准备 Systemd 服务配置文件
- [ ] 准备 Tengine 反向代理配置文件

### 2.2 配置文件定制
- [ ] 配置数据库连接信息（需要用户确认）
- [ ] 配置 Flask 应用端口（建议：5000 或自定义）
- [ ] 配置 LLM API 密钥（需要用户提供）
  - [ ] Insight Engine API Key
  - [ ] Media Engine API Key
  - [ ] Query Engine API Key
  - [ ] Report Engine API Key
  - [ ] Forum Host API Key
  - [ ] Keyword Optimizer API Key
- [ ] 配置搜索 API 密钥（可选）
  - [ ] Tavily API Key
  - [ ] Bocha API Key

### 2.3 前端集成
- [ ] 更新 `peaceportal/portal/index.html` 添加 BettaFish 入口卡片
- [ ] 设计 BettaFish 应用图标和描述
- [ ] 测试前端链接跳转

---

## ✅ 阶段三：服务器端部署

### 3.1 代码部署
- [ ] 在服务器创建项目目录
- [ ] 上传 BettaFish 代码到服务器（Git Clone 或文件传输）
- [ ] 验证代码完整性

### 3.2 Python 环境配置
- [ ] 创建 Python 虚拟环境（conda 或 venv）
- [ ] 安装系统依赖（如 PDF 导出所需依赖）
- [ ] 安装 Python 依赖包（`pip install -r requirements.txt`）
- [ ] 安装 Playwright 浏览器驱动

### 3.3 数据库配置
- [ ] 创建 BettaFish 数据库
- [ ] 配置数据库用户和权限
- [ ] 测试数据库连接
- [ ] （可选）初始化数据库表结构

### 3.4 应用配置
- [ ] 创建 `.env` 配置文件
- [ ] 填写所有必需的配置项
- [ ] 验证配置文件格式正确性
- [ ] 测试应用启动（本地测试）

---

## ✅ 阶段四：服务配置与启动

### 4.1 Systemd 服务配置
- [ ] 创建 `bettafish.service` 文件
- [ ] 配置服务启动命令
- [ ] 配置服务重启策略
- [ ] 配置日志输出
- [ ] 启用并启动服务
- [ ] 验证服务状态

### 4.2 Tengine 反向代理配置
- [ ] 创建或更新 Tengine 配置文件（`bettafish.conf`）
- [ ] 配置 `/bettafish/` 路由规则
- [ ] 配置 WebSocket 支持（SocketIO）
- [ ] 配置静态资源代理
- [ ] 配置超时和缓冲设置
- [ ] 测试配置语法（`tengine -t`）
- [ ] 重载 Tengine 配置

### 4.3 防火墙与安全
- [ ] 确认应用端口仅监听 localhost
- [ ] 配置防火墙规则（如需要）
- [ ] 验证 HTTPS 访问正常

---

## ✅ 阶段五：测试与验证

### 5.1 功能测试
- [ ] 测试主页访问（`https://www.peacewang.com/bettafish/`）
- [ ] 测试 Flask 主界面加载
- [ ] 测试三个 Agent 启动功能
- [ ] 测试报告生成功能
- [ ] 测试数据库连接
- [ ] 测试 LLM API 调用

### 5.2 性能测试
- [ ] 测试应用启动时间
- [ ] 测试并发访问能力
- [ ] 监控内存和 CPU 使用情况
- [ ] 检查日志文件生成

### 5.3 错误处理
- [ ] 测试服务异常重启
- [ ] 测试数据库连接失败处理
- [ ] 测试 API 调用失败处理
- [ ] 验证错误日志记录

---

## ✅ 阶段六：文档更新

### 6.1 更新个人网站文档
- [ ] 更新 `peaceportal/readme.md`
  - [ ] 添加 BettaFish 应用说明
  - [ ] 更新功能列表
  - [ ] 更新目录结构说明
  - [ ] 更新技术栈说明
  - [ ] 更新部署流程说明

### 6.2 创建部署文档
- [ ] 创建 `BettaFish/DEPLOYMENT.md` 部署文档
- [ ] 记录部署步骤和注意事项
- [ ] 记录配置参数说明
- [ ] 记录常见问题解决方案

---

## ✅ 阶段七：优化与维护

### 7.1 性能优化
- [ ] 配置日志轮转
- [ ] 优化数据库连接池
- [ ] 配置缓存策略（如需要）

### 7.2 监控与告警
- [ ] 配置服务健康检查
- [ ] 配置日志监控（如需要）
- [ ] 设置资源使用告警（如需要）

### 7.3 备份策略
- [ ] 配置数据库备份
- [ ] 配置报告文件备份
- [ ] 配置配置文件备份

---

## 📝 注意事项

1. **个性化参数确认**：所有需要用户确认的配置项会在部署过程中明确标注
2. **数据库选择**：建议复用现有 MySQL，或新建 PostgreSQL 数据库
3. **端口冲突**：确保选择的端口不与现有服务冲突
4. **API 密钥安全**：`.env` 文件包含敏感信息，不要提交到 Git
5. **资源限制**：BettaFish 是资源密集型应用，注意服务器资源使用

---

## 🎯 关键决策点

以下决策需要在部署前与用户确认：

1. **部署方式**：源码部署 vs Docker 部署
2. **数据库类型**：PostgreSQL vs MySQL（复用现有 vs 新建）
3. **应用端口**：Flask 主应用端口（默认 5000）
4. **路由路径**：网站访问路径（建议 `/bettafish/`）
5. **LLM API 提供商**：各 Agent 使用的 LLM 服务商和模型
6. **资源限制**：是否需要限制并发或资源使用

---

## 📅 预计时间

- **阶段一**：30 分钟（环境确认）
- **阶段二**：1-2 小时（配置准备）
- **阶段三**：2-3 小时（服务器部署）
- **阶段四**：1-2 小时（服务配置）
- **阶段五**：1 小时（测试验证）
- **阶段六**：30 分钟（文档更新）
- **阶段七**：持续优化

**总计**：约 6-9 小时（不含等待用户确认时间）

